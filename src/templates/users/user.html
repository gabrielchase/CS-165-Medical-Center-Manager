{% extends "base.html" %}

{% block content %}
<div>
    <h1>{{ object.username }}</h1>
    <h1>{{ object.email }}</h1>
    <p>{{ object.mobile_number }}</p>
    <p>{{ object.landline_number }}</p>

    {% if object.is_admin %}
        <p>{{ object.administratordetails.open_time }}</p>
        <p>{{ object.administratordetails.close_time }}</p>
        <p>{{ object.administratordetails.location }}</p>
        <p>{{ object.administratordetails.category }}</p>
        <p>{{ object.administratordetails.staff }}</p>
        <p>{{ object.administratordetails.additional_info }}</p>

        <h1>Services</h1>
        <ul></ul>
        
        {% for service in object.administratordetails.services.all %}
            <li> {{ service.name }} </li>
        {% endfor %}

        <!-- If logged in user is not an admin and they are seeing an institution page,
            they can set up an appointment and CRUD comments --> 

        {% if not current_user.is_admin %}
            <h1>Set An Appointment</h1>
            <p><strong>Make an Appointment</strong></p>
            <form action="{% url 'appointments:create' slug=object.slug %}" method="POST">
                {% csrf_token %}

                <label for="">Date</label>
                <input type="text" name="date">
                <br>
                <br>

                <label for="">Timeslot: </label>
                <select name="timeslot" id="">
                    <option value="none">--- Select ---</option>
                    {% for aptmt in available_appointment_timeslots%}
                        <option value="{{ aptmt.timeslot_id }}">{{ aptmt }}</option>
                    {% endfor %}
                </select>
                <br>
                <br>

                <label for="Service">Service: </label>
                <select name="service" id="">
                    <option value="none">--- Select ---</option>
                    {% for service in object.administratordetails.services.all %}
                        <option value="{{ service.name }}">{{ service.name }}</option>
                    {% endfor %}
                </select>
                <br>
                <br>

                <label for="">Additional Info:</label>
                <br>
                <br>
                <textarea name="additional_info" id="" cols="30" rows="10" ></textarea>
                <br>
                <br>

                <input type="submit" value="Submit" />                
            </form>
            <br>

            <h1>Comments</h1>
            <p><strong>Add Comment</strong></p>
            <form action="{% url 'users:feedback' slug=object.slug %}" method="POST">
                {% csrf_token %}

                {% if current_feedback %}
                    <input type="hidden" name="feedback_id" value="{{ current_feedback.feedback_id }}">
                {% endif %}

                <label for="">Rating:</label>
                <select name="rating" id="" required>
                    {% if current_feedback %}
                        <option value="{{ current_feedback.rating }}">{{ current_feedback.rating }}</option>
                    {% else %}
                        <option value="none">--- Select ---</option>
                    {% endif %}
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
                <br>
                <br>

                <label for="">Comment:</label>
                <br>
                <br>
                <textarea name="comment" id="" cols="30" rows="10" >{% if current_feedback %}{{ current_feedback.comment }}{% endif %}</textarea>
                <br>
                <br>

                <input type="submit" value="Submit" />
            </form>

            <br>
            {% for f in feedback %}
                <p>
                    <strong>by {{ f.user.username}}</strong>: {{ f.rating }} stars 
                    {% if f.user == current_user %}
                        <a href="{% url 'users:detail' slug=object.slug %}?fid={{ f.feedback_id }}">Edit</a>
                        <a href="{% url 'users:feedback' slug=object.slug %}?fid={{ f.feedback_id }}">Delete</a>
                    {% endif %}
                </p>
                <p>{{ f.comment }}</p>
                <br>
            {% endfor %}
        {% endif %}
    {% endif%}
</div>

{% endblock %}