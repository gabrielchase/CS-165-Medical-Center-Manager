<div class="ui grid container centered aligned">
    <div class="column"></div>
    <div class="eleven wide column">  
        {% extends "base.html" %}

        {% block content %}
        
        <div class="row">
            <div class="ui secondary menu" style="border-bottom: 2px solid rgba(34, 36, 38, 0.15);" >
              <a class="item" href={% url 'dashboard:home' %}>Home</a>
              <a class="active item" href={% url 'dashboard:institution-list' %}>View institutions</a>
              <a class="item" href={% url 'users:update' %}>Edit My Profile</a>

              <div class="right secondary menu">
                <a class="ui item" href={% url 'logout' %}> <i class="sign out icon"></i> Logout</a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="ui padded stacked segment" style="margin-top: 20px;">           
            <h1>{{ object.username }}</h1>

            <div class="ui top attached tabular menu">
                <a class="{% if not current_feedback %}active{% endif %}  item" data-tab="profile">Profile</a>
                {% if object.is_admin %}
                    <a class="item" data-tab="services">Services Offered</a>
                    <a class="item" data-tab="products">Products</a>
                    {% if not current_user.is_admin %}
                        <a class="item" data-tab="appointments">Appointments</a>
                    {% endif %}
                    <a class="{% if current_feedback %}active{% endif %} item" data-tab="feedback">Feedback</a>
                {% endif %}
            </div>
            <div class="ui bottom attached segment">
              <div class="ui {% if not current_feedback %}active{% endif %} tab" data-tab="profile">
                <div class="ui basic segment" style="text-align: left">
                    <div class="ui list">
                      <div class="item">
                        <i class="mail icon"></i>
                        <div class="content">{{ object.email }}</div>
                    </div>
                    {% if object.mobile_number %}
                    <div class="item">
                        <i class="mobile icon"></i>
                        <div class="content">{{ object.mobile_number }}</div>
                    </div>
                    {% endif %}

                    {% if object.landline_number %}
                    <div class="item">
                        <i class="call icon"></i>
                        <div class="content">{{ object.landline_number }}</div>
                    </div>
                    {% endif %}
                    {% if object.is_admin %}
                    <div class="item">
                        <div class="content"><i class="fa fa-clock-o"></i> &nbsp;&nbsp;&nbsp;{{ object.administratordetails.open_time }} - {{ object.administratordetails.close_time }}</div>
                    </div>
                    <div class="item">
                        <i class="marker icon"></i>
                        <div class="content">{{ object.administratordetails.location }}</div>
                    </div>
                    <div class="item">
                        <i class="emergency icon"></i>
                        <div class="content">{{ object.administratordetails.category }}</div>
                    </div>
                    <div class="item">
                        <i class="user icon"></i>
                        <div class="content">{{ object.administratordetails.staff }}</div>
                    </div>
                    <div class="item">
                        <i class="info circle icon"></i>
                        <div class="content">{{ object.administratordetails.additional_info }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>
        
    </div>

<div class="ui tab" data-tab="services">
    <div class="ui basic segment">
        <h2>Services Offered</h2>
        <ul>
            {% for service in object.administratordetails.services.all %}
            <li> {{ service.name }} </li>
            {% endfor %}
        </ul>
    </div>
</div>

<div class="ui tab" data-tab="products">
    <div class="ui basic segment">
        <h2>Products In Stock</h2>
        <ul>
            {% for instance in my_products %}
            <li>
                <p> {{ instance.product.brand_name }} - {{ instance.product.generic_name }}: <strong>P{{ instance.price }}</strong> </p>
                <p> Description: {{ instance.description }} </p>
            </li>
            <br>
            {% endfor %}
        </ul>
    </div>
</div>

<div class="ui tab" data-tab="appointments">
    <div class="ui basic segment">
        {% if not current_user.is_admin %}
        <h2>My Appointments</h2>
        <a href="{% url 'appointments:create' slug=object.slug %}">Set an Appointment</a>
        {% if my_appointments_here %}    
        <ul>
            {% for aptmt in my_appointments_here %}
            <li> {{ aptmt.date}} ({{ aptmt.timeslot }}): {{ aptmt.service }} 
                <a href="{% url 'appointments:base' slug=object.slug %}?aptmtid={{ aptmt.appointment_id }}">Cancel</a>
            </li>
            {% endfor %}
        </ul>
        {% endif %}
        {% endif %}
    </div>

</div>


<div class="ui {% if current_feedback %}active{% endif %} tab" data-tab="feedback">
    <div class="ui basic segment">
        {% if not current_user.is_admin %}
            {% if object.is_admin %}
            <h4>Add Comment</h4>
            <form class="ui compact reply form" action="{% url 'users:feedback' slug=object.slug %}" method="POST">
                {% csrf_token %}

                {% if current_feedback %}
                <input type="hidden" name="feedback_id" value="{{ current_feedback.feedback_id }}">
                {% endif %}

                <div class="ui form">
                  <div class="inline fields">
                    <label for="rating">Rating:</label>
                    <div class="field">
                        <input type="hidden" id="rating" name="rating" required>
                      <div class="stars stars-input stars-{% if current_feedback %}{{ current_feedback.rating }}{% else %}0{% endif %}" data-input="#rating" data-value="{% if current_feedback %}{{ current_feedback.rating }}{% else %}0{% endif %}">
                        <i class="star icon"></i><i class="star icon"></i><i class="star icon"></i><i class="star icon"></i><i class="star icon"></i>
                      </div>
                    </div>
                  </div>

               

                <div class="field">
                  <textarea name="comment">{% if current_feedback %}{{ current_feedback.comment }}{% endif %}</textarea>
                </div>
                <button type="submit" class="ui primary submit labeled icon button">
                  <i class="icon edit"></i> Add Comment
                </button>


            </form>
            {% endif %}
        {% endif %}

        <h4>User Feedback</h4>
        <div class="ui segment">
            <div class="ui divided list modlist">
                {% for f in feedback %}
                <div class="item">
                    {% if f.user == current_user %}
                    <div class="right floated content">
                        <small>
                        <a href="{% url 'users:detail' slug=object.slug %}?fid={{ f.feedback_id }}">Edit</a> |
                        <a href="{% url 'users:feedback' slug=object.slug %}?fid={{ f.feedback_id }}">Delete</a>
                        </small>
                    <div class="ui divider"></div>
                    <div class="ui grid center aligned">
                        <h2 class="ui center aligned header" style="margin-top: 50px">Comments</h2>
                        <div class="one column row">
                            <div class="column">
                                {% if not current_user.is_admin %}
                                    {% if object.is_admin %}
                                        <h4>Add Comment</h4>
                                        <form class="ui form" action="{% url 'users:feedback' slug=object.slug %}" method="POST">
                                            {% csrf_token %}

                                            {% if current_feedback %}
                                                <input type="hidden" name="feedback_id" value="{{ current_feedback.feedback_id }}">
                                            {% endif %}

                                            <div class="field">
                                                <label for="">Rating:</label>
                                                <select class="ui fluid dropdown" name="rating" id="" required>
                                                    {% if current_feedback %}
                                                        <option value="{{ current_feedback.rating }}">{{ current_feedback.rating }}</option>
                                                    {% else %}
                                                        <option value="none">--- Select ---</option>
                                                    {% endif %}
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="4">4</option>
                                                    <option value="5">5</option>
                                                </select>
                                            </div>
                                            <br>
                                            <br>
                                            <div class="field">
                                                <label for="">Comment:</label>
                                                <textarea name="comment" id="" cols="30" rows="10" >{% if current_feedback %}{{ current_feedback.comment }}{% endif %}</textarea>
                                            </div>
                                            <input type="submit" value="Submit" class="ui positive button" />
                                        </form>
                                    {% endif %}
                                {% endif %}
                                <br>
                                <br>
                                <h4>User Feedback</h4>
                                <div class="ui segment" id="feedback">
                                    <br>
                                    {% for f in feedback %}
                                        <div class="ui secondary vertical segment">
                                            <strong>by {{ f.user.username}}</strong>: {{ f.rating }} stars 
                                            <p>{{ f.comment }}</p>
                                            {% if f.user == current_user %}
                                                <a href="{% url 'users:detail' slug=object.slug %}?fid={{ f.feedback_id }}" class="ui tiny blue button">Edit</a>
                                                <a href="{% url 'users:feedback' slug=object.slug %}?fid={{ f.feedback_id }}" class="ui tiny black button">Delete</a>
                                            {% endif %}
                                        </div>
                                        
                                        <br>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    <h4 class="ui header">{{ f.user.username}}</h4>
                    <div class="stars stars-{{ f.rating }}"><i class="star icon"></i><i class="star icon"></i><i class="star icon"></i><i class="star icon"></i><i class="star icon"></i></div>

                    
                
                <div class="content" style="padding:2px 0;">{{ f.comment }}</div>

                </div>
                {% endfor %}
            </div>

        </div>


    </div>
</div>


</div>
</div>
</div>
</div>

<script type="text/javascript">

$('.item').on('click', function() {
    $('.item').removeClass('active');
    $(this).addClass('active');
});             

$('.menu .item').tab();

function bituin(){
    var stardex = $(this).index();  
    $('.stars-input').each(function(index) {
        $(this)
            .removeClass('stars-0')
            .removeClass('stars-1')
            .removeClass('stars-2')
            .removeClass('stars-3')
            .removeClass('stars-4')

        if(stardex<5) {
            $(this).addClass('stars-'+(stardex+1));
            $($(this).attr('data-input')).val(stardex+1);
            $(this).attr('data-value', stardex+1);
        } else {
        }
    })
}
$('.stars-input > .star').click(bituin);
$('.stars-input > .star').hover(
    function() {
        var stardex = $(this).index();  
        $('.stars-input').each(function(index) {
            $(this)
                .removeClass('stars-0')
                .removeClass('stars-1')
                .removeClass('stars-2')
                .removeClass('stars-3')
                .removeClass('stars-4')
                .removeClass('stars-5')

            if(stardex<5) {
                $(this).addClass('stars-'+(stardex+1));
            } else {
            }
        })
    },
    function() {
        $parent = $(this).parent();
        $parent
            .removeClass('stars-0')
            .removeClass('stars-1')
            .removeClass('stars-2')
            .removeClass('stars-3')
            .removeClass('stars-4')
            .removeClass('stars-5')

        var val = $parent.attr('data-value');
        if(val < 5) {
            $parent.addClass('stars-'+val);
        } else {
        }
    });

</script>

{% endblock %}